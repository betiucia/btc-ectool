<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC-ECTool</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Graduate&family=Roboto+Condensed:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="toast" class="toast">Dados copiados!</div>

    <div class="tab-nav">
        <button class="tab-btn active" onclick="openTab('items', this)" data-lang="registered_items">Itens Cadastrados</button>
        <button class="tab-btn" onclick="openTab('jobs', this)" data-lang="tab_jobs">Empregos (Jobs)</button>
        <button class="tab-btn" onclick="openTab('config', this)" data-lang="config_short">Configura√ß√µes</button>
    </div>

    <div id="view-items" class="tab-content active">
        <div class="container">
            <div class="panel">
                <div class="panel-header">
                    <h2 data-lang="registered_items">Itens Cadastrados</h2>
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Buscar..." onkeyup="renderTable()">
                    </div>
                    <div style="display:flex; gap:10px;">
                         <button class="btn-plus" onclick="openModal('create')" data-lang-title="tooltip_create_item">+</button>
                         <button class="btn-import-icon" onclick="openImportModal()" data-lang-title="tooltip_import_items">üì•</button>
                         <button class="btn-import-icon" onclick="exportAllItemsDefinitions()" data-lang-title="tooltip_export_all_items" style="background-color: #2e7d32; border-color: #1b5e20;">üì§</button>
                         <button class="btn-import-icon tooltip-right" onclick="copyAllCraftsDefinitions()" data-lang-title="tooltip_copy_all" style="background-color: #e65100; border-color: #e65100;">üìú</button>
                         <button class="btn-import-icon tooltip-right" onclick="generateAutoCategoryGlobal(this)" data-lang-title="tooltip_auto_cat_global" style="background-color: #7b1fa2; border-color: #4a148c;">‚ú®</button>
                    </div>
                </div>
                
                <table id="economyTable">
                    <thead>
                        <tr>
                            <th onclick="handleSort('name')" width="25%"><span data-lang="col_item">Item</span> <span id="sort-name" class="sort-icon">‚áÖ</span></th>
                            <th onclick="handleSort('cat')"><span data-lang="col_cat">Categ.</span> <span id="sort-cat" class="sort-icon">‚áÖ</span></th>
                            <th onclick="handleSort('base')"><span data-lang="col_base">Custo Base</span><br><small data-lang="col_best">(Melhor)</small> <span id="sort-base" class="sort-icon">‚áÖ</span></th>
                            <th onclick="handleSort('sell')"><span data-lang="col_sell">NPC Vende</span><br><small data-lang="col_shop">(Loja)</small> <span id="sort-sell" class="sort-icon">‚áÖ</span></th>
                            <th onclick="handleSort('buy')"><span data-lang="col_buy">NPC Paga</span><br><small data-lang="col_sink">(Sink)</small> <span id="sort-buy" class="sort-icon">‚áÖ</span></th>
                            <th onclick="handleSort('p2p')"><span data-lang="col_p2p">P2P</span><br><small data-lang="col_player">(Player)</small> <span id="sort-p2p" class="sort-icon">‚áÖ</span></th>
                            <th width="120px" data-lang="col_actions">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="view-jobs" class="tab-content">
        <div class="container">
            <div class="panel">
                <div class="panel-header">
                    <h2 data-lang="tab_jobs">Empregos (Jobs)</h2>
                    <button class="btn btn-secondary btn-small" onclick="addTier()" data-lang="btn_add_tier">+ Tier</button>
                </div>
                <div id="jobKanban" class="kanban-container"></div>
            </div>
        </div>
    </div>

    <div id="view-config" class="tab-content">
        <div class="container">
            <div class="panel">
                <div class="panel-header">
                    <h1 data-lang="config_title_simple">Configura√ß√µes</h1>
                </div>
                
                <div class="config-grid">
                    
                    <div class="config-card" style="border-left-color: var(--cor-info);">
                        <h3 data-lang="data_backup">Gerenciamento de Dados</h3>
                        <div style="display:flex; gap:10px; margin-bottom:5px;">
                            <button class="btn btn-secondary" onclick="downloadJSON()" style="flex:1;" data-lang="btn_download_json">üíæ Baixar Backup (JSON)</button>
                            <label class="btn btn-secondary" style="flex:1; text-align:center; cursor:pointer; margin-top:5px; border-color: var(--cor-info); color: var(--cor-info);" data-lang="btn_upload_json">
                                üìÇ Restaurar Backup
                                <input type="file" id="uploadJsonInput" accept=".json" style="display:none;" onchange="uploadJSON(this)">
                            </label>
                        </div>
                        <div style="margin-top: 10px; display:flex;">
                            <button class="btn btn-secondary" onclick="clearAllItems()" style="flex:1; border-color: var(--cor-erro); color: var(--cor-erro);" data-lang="btn_clear_all">üóëÔ∏è Limpar Todos os Itens</button>
                        </div>
                        
                        <small style="color:var(--cor-texto-secundario); display:block; margin-top:10px;" data-lang="backup_hint">Os dados s√£o salvos automaticamente no navegador. Use o Backup para seguran√ßa ou para transferir.</small>
                    </div>

                    <div class="config-card" style="border-left-color: var(--cor-destaque);">
                        <h3 data-lang="global_defaults">Padr√µes Globais</h3>
                        <div class="global-defaults" style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <div class="form-group" style="flex:1; min-width: 150px;">
                                <label data-lang="lbl_framework">Framework do Servidor</label>
                                <select id="globalFramework" onchange="updateCalculations()">
                                    <option value="rsg">RSG</option>
                                    <option value="vorp">VORP Core</option>
                                </select>
                            </div>
                            
                            <div class="form-group" style="width: 100%;">
                                 <label data-lang="api_key_label" data-lang-title="tooltip_api_key" onclick="window.open('https://aistudio.google.com/app/apikey', '_blank')" style="cursor: pointer; text-decoration: underline dotted; color: var(--cor-info);">Google Gemini API Key ‚ÑπÔ∏è</label>
                                 <input type="password" id="configApiKey" placeholder="AI Studio Key..." onchange="updateCalculations()">
                            </div>
                            
                            <div class="form-group" style="flex:1; min-width: 150px;">
                                <label data-lang="mult_npc_sell" data-lang-title="tip_npc_sell">Mult. NPC Vende (Loja)</label>
                                <input type="number" id="globalSellMult" value="2.0" step="0.1" onchange="updateCalculations()">
                            </div>
                            <div class="form-group" style="flex:1; min-width: 150px;">
                                <label data-lang="mult_npc_buy" data-lang-title="tip_npc_buy">Mult. NPC Compra (Sink)</label>
                                <input type="number" id="globalBuyMult" value="0.5" step="0.1" onchange="updateCalculations()">
                            </div>
                            <div class="form-group" style="flex:1; min-width: 150px;">
                                <label data-lang="margin_p2p" data-lang-title="tip_p2p">Margem P2P (%)</label>
                                <input type="number" id="globalP2PMargin" value="30" step="5" onchange="updateCalculations()">
                            </div>
                            
                            <div class="form-group" style="width: 100%;">
                                <label data-lang="img_path" data-lang-title="tip_img_path">Caminho da Pasta de Imagens</label>
                                <input type="text" id="globalImagePath" value="" placeholder="ex: img/items/" onchange="updateCalculations()">
                            </div>
                            
                            <div class="form-group" style="width: 100%; border-top: 1px dashed var(--cor-borda-fraca); padding-top: 10px;">
                                <label data-lang="lbl_language">Idioma / Language</label>
                                <select id="langSelect" onchange="setLanguage(this.value)">
                                    <option value="en" selected>üá∫üá∏ English</option>
                                    <option value="pt">üáßüá∑ Portugu√™s (Brasil)</option>
                                    <option value="de">üá©üá™ Deutsch</option>
                                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="config-card">
                        <h3 data-lang="categories">Categorias</h3>
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 110px 50px; gap: 5px; font-size: 0.8em; margin-bottom: 5px; color: var(--cor-texto-secundario);">
                            <span data-lang="name">Nome</span>
                            <span data-lang="mult_sell_short" data-lang-title="tip_mult_sell_short">Mult. Venda</span>
                            <span data-lang="mult_buy_short" data-lang-title="tip_mult_buy_short">Mult. Compra</span>
                            <span data-lang="margin_p2p_short" data-lang-title="tip_margin_p2p_short">Margem P2P</span>
                            <span></span>
                            <span></span>
                        </div>
                        <div id="categoryList"></div>
                        <button class="btn btn-secondary btn-small" onclick="addCategory()" data-lang="btn_add_cat">+ Nova Categoria</button>
                    </div>

                    <div class="config-card" style="border-left-color: #5d4037;">
                        <h3 data-lang="crafting_tables">Mesas de Craft</h3>
                        <div id="craftingTablesList"></div>
                        <button class="btn btn-secondary btn-small" onclick="addCraftingTable()" data-lang="btn_add_table">+ Nova Mesa</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="importModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeImportModal()">&times;</span>
            <h2 data-lang="modal_import_title">Importar Itens</h2>
            
            <div class="form-group">
                <label data-lang="lbl_import_type">Tipo de Importa√ß√£o</label>
                <select id="importType">
                    <option value="rsg">RSG (Lua Table)</option>
                    <option value="vorp">VORP (SQL Insert)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label data-lang="lbl_paste_code">Cole o c√≥digo aqui</label>
                <textarea id="importContent" rows="10" placeholder="Cole o c√≥digo Lua ou SQL aqui..."></textarea>
            </div>

            <div style="display:flex; justify-content: flex-end;">
                <button class="btn btn-primary" onclick="processImport()" style="width:auto;" data-lang="btn_process_import">Processar Importa√ß√£o</button>
            </div>
        </div>
    </div>

    <div id="inputModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close" onclick="closeInputModal()">&times;</span>
            <h2 id="inputModalTitle">Titulo</h2>
            <div class="form-group">
                <label id="inputModalLabel">Label</label>
                <input type="text" id="inputModalField" onkeydown="if(event.key==='Enter') confirmInputModal()">
            </div>
            <div style="display:flex; justify-content: flex-end; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeInputModal()" style="width:auto;" data-lang="btn_cancel">Cancelar</button>
                <button class="btn btn-primary" onclick="confirmInputModal()" style="width:auto;" data-lang="btn_confirm_delete">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="itemModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()" title="Fechar Modal">&times;</span>
            <h2 id="modalTitle" data-lang="modal_manage_title">Gerenciar Item</h2>
            <form id="itemForm">
                <input type="hidden" id="edit_index" value="-1">
                
                <div style="display:flex; gap:15px; margin-bottom: 15px;">
                    <div class="form-group" style="flex:1;">
                        <label data-lang="item_id">ID do Item</label>
                        <input type="text" id="modal_itemId" required>
                    </div>
                    <div class="form-group" style="flex:1;">
                        <label data-lang="item_name">Nome</label>
                        <input type="text" id="modal_itemName" required>
                    </div>
                    <div class="form-group" style="flex:1;">
                        <label data-lang="category">Categoria</label>
                        <div style="display:flex; gap:5px;">
                            <div id="categoryDropdownContainer" style="flex:1;"></div>
                            <button type="button" class="btn btn-secondary btn-ai" style="width:auto; padding:0 10px; background: linear-gradient(135deg, #7b1fa2, #4a148c); border-color: #9c27b0;" onclick="generateAICategory(this)" data-lang-title="tooltip_auto_cat_single">‚ú®</button>
                        </div>
                    </div>
                </div>

                <div style="display:flex; gap:15px; margin-bottom: 15px;">
                    <div class="form-group" style="flex:2;">
                        <label data-lang="description">Descri√ß√£o</label>
                        <div style="display:flex; gap:5px;">
                            <textarea id="modal_description" rows="1" style="flex:1"></textarea>
                            <button type="button" class="btn btn-secondary btn-ai" style="width:auto; padding:0 10px;" onclick="generateAIDescription()" data-lang="btn_generate_ai">‚ú® Gerar</button>
                        </div>
                    </div>
                    <div class="form-group" style="flex:1;">
                        <label data-lang="image_name" data-lang-title="tip_image_override">Nome Imagem (Opcional)</label>
                        <input type="text" id="modal_imageOverride">
                        <small style="color:var(--cor-texto-secundario)" data-lang="tip_png_ext">Extens√£o .png autom√°tica</small>
                    </div>
                </div>

                <div class="section-box" style="margin-bottom:15px; border-left: 4px solid var(--cor-info);">
                    <h3 id="frameworkHeader" style="border:none; padding-bottom:0; margin-bottom:10px; font-size:1em; color: var(--cor-info);" data-lang="header_framework_data">Dados da Framework</h3>
                    <div id="frameworkFields" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                        </div>
                </div>

                <div class="section-box">
                    <label style="display:flex; align-items:center;">
                        <input type="checkbox" id="modal_isCrafted" onchange="toggleCraftMode()" style="width:auto; margin-right:10px;">
                        <span data-lang="is_crafted">Item Craft√°vel? (Habilitar Receitas)</span>
                    </label>
                    
                    <div id="modal_craftingSection" style="display:none; margin-top:15px;">
                        <div id="recipesContainer"></div>
                        <div style="display:flex; gap:10px;">
                            <button type="button" class="btn btn-secondary" onclick="addRecipeCard()" style="border: 1px dashed var(--cor-borda-forte); flex:1;" data-lang="btn_add_variant">+ Adicionar Variante de Craft</button>
                             <button type="button" class="btn btn-secondary btn-ai" onclick="generateAIRecipe()" style="flex:1;" data-lang="btn_suggest_recipe">‚ú® Sugerir Receita IA</button>
                        </div>
                    </div>
                </div>

                <div class="form-group" style="margin-top:10px;">
                    <label data-lang="manual_cost">Custo Base Manual ($)</label>
                    <input type="number" step="0.01" id="modal_costPrice" onchange="previewPrices()" placeholder="0.00">
                    <small style="color:var(--cor-texto-secundario);" data-lang="manual_cost_hint">Usado se n√£o houver receitas ou se 'Item Craft√°vel' estiver desmarcado.</small>
                </div>

                <div class="calc-preview">
                    <div class="calc-item">
                        <small data-lang="calc_base">Custo Base</small>
                        <span id="modal_prevBase" style="color:#ddd;">$ 0.00</span>
                    </div>
                    <div class="calc-item">
                        <small data-lang="calc_p2p">P2P Sugerido</small>
                        <span id="modal_prevP2P" class="val-p2p">$ 0.00</span>
                    </div>
                    <div class="calc-item">
                        <small data-lang="calc_sell">NPC Vende</small>
                        <span id="modal_prevSell" class="val-sell">$ 0.00</span>
                    </div>
                    <div class="calc-item">
                        <small data-lang="calc_buy">NPC Paga</small>
                        <span id="modal_prevBuy" class="val-buy">$ 0.00</span>
                    </div>
                </div>

                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button type="button" class="btn btn-secondary btn-export" onclick="exportLua()" style="flex:1;" data-lang="btn_export_lua">Copiar Craft Lua</button>
                    <button type="button" class="btn btn-secondary btn-export" style="background-color: var(--cor-info); border-color: #01579b; flex:1;" onclick="exportItemDefinition()" id="btnExportDef" data-lang="btn_export_item_def">Exportar Item</button>
                    <button type="submit" class="btn btn-primary" style="flex:2;" data-lang="btn_save">Salvar Item</button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h2 style="color: var(--cor-erro);" data-lang="delete_title">Confirmar Exclus√£o</h2>
            <p id="deleteMsg" style="color: var(--cor-texto-secundario);" data-lang="delete_msg">Deseja excluir este item?</p>
            <p id="deleteItemName" style="font-weight: bold; color: var(--cor-texto-principal); font-size: 1.2em; margin: 20px 0;"></p>
            <div class="delete-btns">
                <button class="btn btn-secondary" onclick="closeDeleteModal()" style="width: auto;" data-lang="btn_cancel">Cancelar</button>
                <button class="btn" style="background-color: var(--cor-erro); color: white; width: auto; border-color: var(--cor-erro-borda);" onclick="confirmDelete()" data-lang="btn_confirm_delete">Sim, Excluir</button>
            </div>
        </div>
    </div>

    <div id="jobModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeJobModal()">&times;</span>
            <h2 data-lang="modal_job_title">Configurar Emprego</h2>
            <p style="color:var(--cor-texto-secundario); font-size:0.9em; margin-bottom:15px;" data-lang="hint_job_calc">Defina quanto o emprego ganha em X minutos.</p>
            
            <form id="jobForm">
                <input type="hidden" id="job_edit_id">
                <input type="hidden" id="job_tier_id">

                <div style="display:flex; gap:15px; margin-bottom: 15px;">
                    <div class="form-group" style="flex:2;">
                        <label data-lang="lbl_job_name" data-lang-title="tip_job_name">Nome do Emprego</label>
                        <input type="text" id="job_name" required>
                    </div>
                    <div class="form-group" style="flex:1;">
                        <label data-lang="lbl_session_time" data-lang-title="tip_job_time">Tempo (Minutos)</label>
                        <input type="number" id="job_time" min="1" value="60" onchange="calculateJobGains()">
                    </div>
                </div>

                <div class="section-box">
                    <div class="form-group">
                        <label data-lang="lbl_direct_gain" data-lang-title="tip_job_money">Ganho Monet√°rio Direto ($)</label>
                        <input type="number" id="job_money" step="0.01" value="0" placeholder="0.00" onchange="calculateJobGains()">
                    </div>
                    
                    <div style="margin-top:15px; border-top:1px dashed var(--cor-borda-fraca); padding-top:10px;">
                        <label style="margin-bottom:10px;" data-lang="lbl_items_gain" data-lang-title="tip_job_items">Ganho em Itens (Farm)</label>
                        <div id="jobItemsContainer" class="job-items-table-container"></div>
                        <button type="button" class="btn btn-secondary btn-small" onclick="addJobItemRow()" data-lang="btn_add_item_row">+ Item Farmado</button>
                    </div>

                    <div style="margin-top:15px; border-top:1px dashed var(--cor-borda-fraca); padding-top:10px;">
                        <label style="margin-bottom:10px; color: var(--cor-erro);" data-lang="lbl_expenses" data-lang-title="tip_job_tools">Custos / Ferramentas Usadas</label>
                        <div style="display: grid; grid-template-columns: 2fr 0.6fr 0.6fr 0.6fr 30px; gap:8px; font-size:0.75em; color:var(--cor-texto-secundario); margin-bottom:5px; padding-left:5px;">
                            <span data-lang="col_item">Item</span>
                            <span data-lang="ph_qty">Qtd</span>
                            <span data-lang="lbl_degradation_short">Deg%</span>
                            <span data-lang="lbl_consumed">Consumido?</span>
                            <span></span>
                        </div>
                        <div id="jobToolsContainer" class="job-items-table-container" style="border-color: var(--cor-erro-borda);"></div>
                        <button type="button" class="btn btn-secondary btn-small" onclick="addJobToolRow()" style="border-color:var(--cor-erro); color:var(--cor-texto-principal);" data-lang="btn_add_tool_row">+ Ferramenta</button>
                    </div>
                </div>

                <div class="job-calc-summary-detailed">
                    <div class="summary-row">
                        <span data-lang="lbl_gross">Bruto (Sess√£o)</span>
                        <span id="summary_gross" class="val-gross">$ 0.00</span>
                    </div>
                    <div class="summary-row">
                        <span data-lang="lbl_costs">Custos (Sess√£o)</span>
                        <span id="summary_cost" class="val-cost">- $ 0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span data-lang="lbl_profit_npc">Lucro L√≠quido (NPC)</span>
                        <span id="summary_net_npc" style="color:var(--cor-sucesso)">$ 0.00 / min</span>
                    </div>
                    <div class="summary-row total" style="border-top:none; margin-top:0;">
                        <span data-lang="lbl_profit_p2p">Lucro L√≠quido (P2P)</span>
                        <span id="summary_net_p2p" style="color:var(--cor-destaque)">$ 0.00 / min</span>
                    </div>
                </div>

                <div style="display:flex; justify-content: flex-end; gap: 10px; margin-top:20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeJobModal()" data-lang="btn_cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-lang="btn_save">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="locale.js"></script>
    <script src="script.js"></script>
    <script src="script_job.js"></script>
</body>
</html>